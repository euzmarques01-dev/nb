<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>PlenÃ¡rio EletrÃ´nico Nacional</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
 --verde:#22c55e;
 --vermelho:#ef4444;
 --branco:#e5e7eb;
 --laranja:#f59e0b;
 --vidro:rgba(255,255,255,.08);
}

body{
 margin:0;
 background:radial-gradient(circle at top,#1e293b,#020617 70%);
 font-family:Segoe UI,Arial;
 color:#fff;
 display:flex;
 justify-content:center;
 padding:10px;
}

.painel{
 width:100%;
 max-width:960px;
 background:linear-gradient(145deg,#0b122e,#020617);
 border-radius:24px;
 padding:18px;
 box-shadow:0 30px 80px rgba(0,0,0,.85);
}

.topo{text-align:center;border-bottom:1px solid rgba(255,255,255,.12);padding-bottom:10px;}
.topo h1{margin:0;font-size:clamp(18px,4vw,30px);}

.resumo{
 display:grid;
 grid-template-columns:repeat(4,1fr);
 gap:10px;
 margin:16px 0;
}

.card{
 background:var(--vidro);
 border-radius:16px;
 padding:12px;
 text-align:center;
}
.card h2{margin:0;font-size:30px;}

.verde{color:var(--verde);}
.vermelho{color:var(--vermelho);}
.branco{color:var(--branco);}
.laranja{color:var(--laranja);}

.lista{display:grid;gap:8px;}
.item{
 background:var(--vidro);
 padding:10px;
 border-radius:14px;
}

.adminPanel{
 display:none;
 margin-top:14px;
 background:rgba(255,255,255,.05);
 padding:14px;
 border-radius:18px;
}

input,select,button{
 width:100%;
 padding:10px;
 border-radius:10px;
 border:none;
 margin-top:6px;
}

button{
 background:#2563eb;
 color:#fff;
 font-weight:bold;
 cursor:pointer;
}

.comprovante{
 background:#fff;
 color:#000;
 padding:12px;
 border-radius:8px;
 margin-top:10px;
 font-family:monospace;
}
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
   apiKey: "AIzaSyC9GU3lD0dpfPwIKNlidhNbMAj8bmBUZXo",
   authDomain: "painel-d5b2b.firebaseapp.com",
   databaseURL: "https://painel-d5b2b-default-rtdb.firebaseio.com",
   projectId: "painel-d5b2b",
   storageBucket: "painel-d5b2b.appspot.com",
   messagingSenderId: "967861220762",
   appId: "1:967861220762:web:c70d12c051fe075b9a7623"
};

// Inicializa Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
</script>

</head>
<body>

<div class="painel">

<div class="topo">
 <h1 id="titulo">PL NÂº 071/2025 â€” Reforma PolÃ­tica</h1>
</div>

<div class="resumo">
 <div class="card verde"><h2 id="favor">0</h2>A FAVOR</div>
 <div class="card vermelho"><h2 id="contra">0</h2>CONTRA</div>
 <div class="card branco"><h2 id="abst">0</h2>ABST.</div>
 <div class="card laranja"><h2 id="falta">0</h2>FALTAM</div>
</div>

<h3 id="status">EM VOTAÃ‡ÃƒO</h3>

<div id="lista" class="lista"></div>

<hr>

<input type="password" id="senha" placeholder="Senha do Fundador">
<button onclick="login()">ENTRAR COMO FUNDADOR</button>

<div class="adminPanel" id="adminPanel">

<h3>ðŸ‘‘ CONTROLE DO FUNDADOR</h3>

<input id="novoTitulo" placeholder="TÃ­tulo do Projeto">
<input id="meta" type="number" placeholder="Votos necessÃ¡rios para aprovaÃ§Ã£o">
<input id="nomeAprovado" placeholder="Texto quando aprovado">

<button onclick="salvarConfig()">SALVAR CONFIGURAÃ‡ÃƒO</button>

<hr>

<h4>âž• Criar Partido</h4>
<input id="pNome" placeholder="Nome do Partido">
<input id="pQtd" type="number" placeholder="Quantidade de votos">
<button onclick="criarPartido()">CRIAR PARTIDO</button>

<hr>

<div id="editor"></div>

<hr>
<button onclick="resetar()">ðŸ”„ RESETAR TUDO</button>

<h4>ðŸ§¾ HISTÃ“RICO</h4>
<div id="historico"></div>

</div>

<div id="comprovante"></div>

<script>
const SENHA = "1111";

// ReferÃªncias de elementos
const senha = document.getElementById("senha");
const pNome = document.getElementById("pNome");
const pQtd = document.getElementById("pQtd");
const meta = document.getElementById("meta");
const nomeAprovado = document.getElementById("nomeAprovado");
const editor = document.getElementById("editor");
const historicoDiv = document.getElementById("historico");
const listaDiv = document.getElementById("lista");
const favorDiv = document.getElementById("favor");
const contraDiv = document.getElementById("contra");
const abstDiv = document.getElementById("abst");
const faltaDiv = document.getElementById("falta");
const statusDiv = document.getElementById("status");
const tituloDiv = document.getElementById("titulo");
const comprovanteDiv = document.getElementById("comprovante");

// Inicializa arrays
let partidos = [];
let historico = [];
let config = {meta:0, nome:""};

// Ler dados em tempo real do Firebase
db.ref("plenario").on("value", snap => {
  const dados = snap.val();
  if(dados){
    partidos = dados.partidos || [];
    historico = dados.historico || [];
    config = dados.config || {meta:0,nome:""};
    render();
    renderEditor();
    renderHistorico();
  }
});

// Salvar dados na nuvem
function salvar(){
  db.ref("plenario").set({
    partidos,
    historico,
    config
  });
}

function render(){
 let f=0, c=0, a=0, total=0;
 listaDiv.innerHTML="";

 partidos.forEach(p=>{
  total+=p.qtd;
  if(p.voto==="favor") f+=p.qtd;
  if(p.voto==="contra") c+=p.qtd;
  if(p.voto==="abst") a+=p.qtd;

  if(p.voto){
   listaDiv.innerHTML+=`<div class="item">${p.nome} â€” ${p.voto.toUpperCase()} (${p.qtd})</div>`;
  }
 });

 favorDiv.textContent = f;
 contraDiv.textContent = c;
 abstDiv.textContent = a;
 faltaDiv.textContent = total-(f+c+a);

 if(config.meta && f>=config.meta){
  statusDiv.textContent = config.nome || "APROVADO";
 }
}

function login(){
 if(senha.value===SENHA){
  document.getElementById("adminPanel").style.display="block";
  renderEditor();
  renderHistorico();
 }
}

function criarPartido(){
 partidos.push({nome:pNome.value, qtd:+pQtd.value, voto:null});
 salvar();
 renderEditor();
 render();
}

function votar(i,tipo){
 let p = partidos[i];
 p.voto = tipo;

 let data = new Date().toLocaleString();
 historico.push(`${p.nome} | ${tipo.toUpperCase()} | ${p.qtd} | ${data}`);

 comprovanteDiv.innerHTML = `
  <div class="comprovante">
   COMPROVANTE DE VOTAÃ‡ÃƒO<br><br>
   PARTIDO: ${p.nome}<br>
   VOTOS: ${p.qtd}<br>
   VOTO: ${tipo.toUpperCase()}<br>
   PROJETO: ${tituloDiv.textContent}<br>
   DATA: ${data}
  </div>`;

 salvar();
 render();
 renderHistorico();
}

function renderEditor(){
 editor.innerHTML="";
 partidos.forEach((p,i)=>{
  editor.innerHTML+=`
   <div class="item">
    <strong>${p.nome}</strong> (${p.qtd})
    <select onchange="votar(${i},this.value)">
     <option value="">Selecionar voto</option>
     <option value="favor">A Favor</option>
     <option value="contra">Contra</option>
     <option value="abst">AbstenÃ§Ã£o</option>
    </select>
   </div>`;
 });
}

function salvarConfig(){
 config.meta = +meta.value;
 config.nome = nomeAprovado.value;
 salvar();
}

function resetar(){
 if(confirm("Resetar tudo?")){
  partidos=[];
  historico=[];
  config = {meta:0, nome:""};
  editor.innerHTML = "";
  historicoDiv.innerHTML = "";
  listaDiv.innerHTML = "";
  favorDiv.textContent = 0;
  contraDiv.textContent = 0;
  abstDiv.textContent = 0;
  faltaDiv.textContent = 0;
  statusDiv.textContent = "EM VOTAÃ‡ÃƒO";
  salvar();
 }
}

function renderHistorico(){
 historicoDiv.innerHTML = historico.map(h=>`<div class="item">${h}</div>`).join("");
}

render();
</script>

</body>
</html>
