<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Resultados – TSE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:'Roboto',sans-serif}
body{margin:0;background:#f2f4f7;color:#111}
header{background:#0b5ed7;color:white;padding:14px 18px;display:flex;align-items:center;font-size:18px}
header img{height:32px;margin-right:10px}
header button{margin-left:auto;background:white;color:#0b5ed7;border:none;padding:6px 12px;border-radius:6px;cursor:pointer}
#geral,#admin{background:white;margin:12px;border-radius:10px;padding:16px}
.resumo{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px}
.box{border:1px solid #ddd;border-radius:8px;padding:10px}
.candidato{display:flex;gap:10px;padding:8px 0;border-bottom:1px solid #eee;align-items:center}
.candidato img{width:42px;height:42px;border-radius:50%;object-fit:cover}
.tag{display:inline-block;padding:2px 8px;font-size:11px;border-radius:6px;margin-left:6px;font-weight:700}
.eleito{background:#0d6efd;color:white;animation:pulse 1s infinite}
.segundo{background:#ffc107;color:black;animation:pulse 1s infinite}
@keyframes pulse{0%{opacity:.6}50%{opacity:1}100%{opacity:.6}}
.barra{height:10px;background:#e9ecef;border-radius:6px;margin-top:6px;overflow:hidden}
.barra span{display:block;height:100%;background:#0b5ed7}
.estado{background:#e0e0e0;border:1px solid #ccc;border-radius:8px;padding:12px 6px;text-align:center;cursor:pointer}
.estado small{display:block;font-size:12px}
#estados{margin:12px;display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:10px}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;justify-content:center;align-items:flex-end}
.modalBox{background:white;width:100%;max-height:90vh;overflow:auto;border-radius:12px 12px 0 0;padding:16px}
#admin{display:none;border-top:4px solid #0b5ed7}
#admin input,#admin select{width:100%;padding:8px;margin:6px 0}
#admin button{background:#0b5ed7;color:white;border:none;padding:10px;border-radius:6px;width:100%;cursor:pointer}
.adminCand{border:1px solid #ddd;border-radius:8px;padding:10px;margin-bottom:8px;display:flex;gap:8px}
.adminCand img{width:42px;height:42px;border-radius:50%}
.adminCand .acoes{display:flex;gap:4px;flex-wrap:wrap}
.adminCand button{flex:1;border:none;border-radius:6px;padding:6px;cursor:pointer}
.eleitoBtn{background:#0d6efd;color:white}
.segundoBtn{background:#ffc107;color:black}
.removerBtn{background:#dc3545;color:white}
h4.cargoTitle{text-transform:uppercase;font-size:14px;margin:10px 0 4px}
</style>
</head>

<body>

<header>
  <img src="https://www.estudotop.com.br/wp-content/uploads/elementor/thumbs/logo-tse-unificado_3-q05569dfkxnbyd38wsipr6u6y7klwz2ncpfpehoub2.png">
  TRIBUNAL SUPERIOR ELEITORAL – TSE
  <button onclick="login()">NAÇÃO BRASILEIRA</button>
</header>

<div id="geral">
<h2>Apuração Nacional</h2>
<div class="barra"><span id="barraGeral"></span></div>
<p><strong>Urnas:</strong> <span id="gUrnas">0%</span></p>
<div class="resumo">
  <div class="box">Total votos: <strong id="gTotal">0</strong></div>
  <div class="box">Brancos: <strong id="gBrancos">0</strong></div>
  <div class="box">Nulos: <strong id="gNulos">0</strong></div>
</div>
<h3>Presidente</h3>
<div id="presidenteNacional"></div>
</div>

<div id="estados"></div>

<div class="modal" id="modal">
  <div class="modalBox">
    <h2 id="tituloEstado"></h2>
    <p><strong>Urnas:</strong> <span id="eUrnas"></span>%</p>
    <div class="barra"><span id="barraEstado"></span></div>
    <p><strong>Brancos:</strong> <span id="eBrancos"></span></p>
    <p><strong>Nulos:</strong> <span id="eNulos"></span></p>
    <div id="listaCandidatos"></div>
    <button onclick="fechar()">Fechar</button>
  </div>
</div>

<div id="admin">
<h2>Painel do Fundador</h2>
<select id="admEstado"></select>
<input type="color" id="admCor" value="#0b5ed7">
<button onclick="definirCor()">Definir cor do estado</button>

<hr>

<select id="admCargo">
  <option>presidente</option>
  <option>governador</option>
  <option>senador</option>
  <option>deputado</option>
</select>

<input id="admNome" placeholder="Nome">
<input id="admPartido" placeholder="Partido">
<input type="number" id="admVotos" placeholder="Votos">
<button onclick="criarCandidato()">Criar candidato</button>

<hr>

<input type="number" id="admUrnas" placeholder="% Urnas">
<input type="number" id="admBrancos" placeholder="Brancos">
<input type="number" id="admNulos" placeholder="Nulos">
<button onclick="atualizarEstado()">Atualizar estado</button>

<hr>
<div id="listaAdmin"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, set, push, update, onValue, get, remove } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAQDxwl33JaLvr386hrO-a_3CTidYPImO8",
  authDomain: "governo-a7830.firebaseapp.com",
  databaseURL: "https://governo-a7830-default-rtdb.firebaseio.com",
  projectId: "governo-a7830",
  storageBucket: "governo-a7830.firebasestorage.app",
  messagingSenderId: "358777941310",
  appId: "1:358777941310:web:2e4e6852e9d6fb1ca3d06f"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const senha="2007";
const estados=["AC","AL","AP","AM","BA","CE","DF","ES","GO","MA","MT","MS","MG","PA","PB","PR","PE","PI","RJ","RN","RS","RO","RR","SC","SP","SE","TO"];

const estadosDiv=document.getElementById("estados");
const sel=document.getElementById("admEstado");

estados.forEach(e=>{
  set(ref(db,'estados/'+e),{urnas:0,brancos:0,nulos:0,cor:"#e0e0e0",candidatos:{}});
  estadosDiv.innerHTML+=`<div class="estado" id="uf-${e}" onclick="abrir('${e}')">${e}<small>0%</small></div>`;
  sel.innerHTML+=`<option>${e}</option>`;
});

window.login=()=>{ if(prompt("Senha")==senha) admin.style.display="block" }

window.definirCor=()=>update(ref(db,'estados/'+sel.value),{cor:admCor.value})

window.criarCandidato=()=>{
  const c={nome:admNome.value,partido:admPartido.value,cargo:admCargo.value,votos:+admVotos.value||0,status:""};
  push(ref(db,'estados/'+sel.value+'/candidatos'),c);
}

window.atualizarEstado=()=>update(ref(db,'estados/'+sel.value),{
  urnas:+admUrnas.value||0,
  brancos:+admBrancos.value||0,
  nulos:+admNulos.value||0
});

function format(n){return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}

function atualizarGeral(){
  let total=0,br=0,nu=0,pres={};
  estados.forEach(uf=>{
    get(ref(db,'estados/'+uf)).then(s=>{
      const d=s.val();
      br+=d.brancos;nu+=d.nulos;
      Object.values(d.candidatos||{}).forEach(c=>{
        if(c.cargo==="presidente"){
          pres[c.nome]=pres[c.nome]||{v:0,p:c.partido,s:c.status};
          pres[c.nome].v+=c.votos;
          pres[c.nome].s=c.status;
          total+=c.votos;
        }
      });
      gTotal.textContent=format(total);
      gBrancos.textContent=format(br);
      gNulos.textContent=format(nu);
      presidenteNacional.innerHTML="";
      Object.entries(pres).sort((a,b)=>b[1].v-a[1].v).forEach(([n,c])=>{
        presidenteNacional.innerHTML+=`<div class="candidato"><div><strong>${n}</strong> (${c.p}) ${c.s?"<span class='tag "+c.s+"'>"+c.s.toUpperCase()+"</span>":""}<br>${format(c.v)} votos</div></div>`;
      });
    });
  });
}

estados.forEach(uf=>{
  onValue(ref(db,'estados/'+uf),snap=>{
    const d=snap.val();
    const div=document.getElementById("uf-"+uf);
    div.style.background=d.cor;
    div.innerHTML=`${uf}<small>${d.urnas}%</small>`;
    atualizarGeral();
  });
});

window.abrir=uf=>{
  modal.style.display="flex";
  tituloEstado.textContent=uf;
}

window.fechar=()=>modal.style.display="none";
</script>

</body>
</html>
