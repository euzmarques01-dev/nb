<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Resultados – TSE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;font-family:'Roboto',sans-serif}
body{margin:0;background:#f2f4f7;color:#111}
header{background:#0b5ed7;color:white;padding:14px 18px;display:flex;align-items:center;font-size:18px}
header img{height:32px;margin-right:10px}
header button{margin-left:auto;background:white;color:#0b5ed7;border:none;padding:6px 12px;border-radius:6px;cursor:pointer}
#geral,#admin{background:white;margin:12px;border-radius:10px;padding:16px}
.resumo{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px}
.box{border:1px solid #ddd;border-radius:8px;padding:10px;font-family:'Roboto',sans-serif}
.candidato{display:flex;gap:10px;padding:8px 0;border-bottom:1px solid #eee;align-items:center;font-family:'Roboto',sans-serif}
.candidato img{width:42px;height:42px;border-radius:50%;object-fit:cover;cursor:pointer}
.tag{display:inline-block;padding:2px 8px;font-size:11px;border-radius:6px;margin-left:6px;font-weight:700}
.eleito{background:#0d6efd;color:white;animation:pulse 1s infinite}
.segundo{background:#ffc107;color:black;animation:pulse 1s infinite}
@keyframes pulse{0%{opacity:0.6}50%{opacity:1}100%{opacity:0.6}}
.barra{height:10px;background:#e9ecef;border-radius:6px;margin-top:6px;overflow:hidden}
.barra span{display:block;height:100%;width:0%;background:#0b5ed7;transition:.3s}
.estado{background:#e0e0e0;border:1px solid #ccc;border-radius:8px;padding:12px 6px;text-align:center;cursor:pointer;transition:.3s;font-family:'Roboto',sans-serif;text-transform:uppercase}
.estado small{display:block;font-size:12px}
#estados{margin:12px;display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:10px}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;justify-content:center;align-items:flex-end}
.modalBox{background:white;width:100%;max-height:90vh;overflow:auto;border-radius:12px 12px 0 0;padding:16px}
#admin{display:none;border-top:4px solid #0b5ed7}
#admin input,#admin select{width:100%;padding:8px;margin:6px 0}
#admin button{background:#0b5ed7;color:white;border:none;padding:10px;border-radius:6px;width:100%;cursor:pointer}
.adminCand{border:1px solid #ddd;border-radius:8px;padding:10px;margin-bottom:8px;display:flex;align-items:center;gap:8px}
.adminCand .acoes{display:flex;gap:4px;width:100%;flex-wrap:wrap}
.adminCand .eleitoBtn{background:#0d6efd;color:white;padding:6px;border:none;border-radius:6px;flex:1;cursor:pointer}
.adminCand .segundoBtn{background:#ffc107;color:black;padding:6px;border:none;border-radius:6px;flex:1;cursor:pointer}
.adminCand .removerBtn{background:#dc3545;color:white;padding:6px;border:none;border-radius:6px;flex:1;cursor:pointer}
#painelStatusRapido div{margin-bottom:6px;display:flex;align-items:center;gap:6px;flex-wrap:wrap}
#painelStatusRapido button{padding:6px 12px;border-radius:6px;border:none;cursor:pointer;font-weight:700}
h4.cargoTitle{margin:10px 0 4px 0;font-size:14px;color:#333;font-weight:700;font-family:'Roboto',sans-serif;text-transform:uppercase}
</style>
</head>
<body>

<header>
  <img src="https://www.estudotop.com.br/wp-content/uploads/elementor/thumbs/logo-tse-unificado_3-q05569dfkxnbyd38wsipr6u6y7klwz2ncpfpehoub2.png">
  TRIBUNAL SUPERIOR ELEITORAL – TSE
  <button onclick="login()">NAÇÃO BRASILEIRA</button>
</header>

<div id="geral">
<h2>Apuração Nacional</h2>
<div class="barra"><span id="barraGeral"></span></div>
<p><strong>Urnas:</strong> <span id="gUrnas">0%</span></p>
<div class="resumo">
  <div class="box"><span>Total votos:  </span><strong id="gTotal">0</strong></div>
  <div class="box"><span>Brancos:  </span><strong id="gBrancos">0</strong></div>
  <div class="box"><span>Nulos:  </span><strong id="gNulos">0</strong></div>
</div>
<h3>Presidente</h3>
<div id="presidenteNacional"></div>
</div>

<div id="estados"></div>

<div class="modal" id="modal">
  <div class="modalBox">
    <h2 id="tituloEstado"></h2>
    <p><strong>Urnas:</strong> <span id="eUrnas"></span>%</p>
    <div class="barra"><span id="barraEstado"></span></div>
    <p><strong>Brancos:</strong> <span id="eBrancos"></span></p>
    <p><strong>Nulos:</strong> <span id="eNulos"></span></p>
    <div id="listaCandidatos"></div>
    <button onclick="fechar()">Fechar</button>
  </div>
</div>

<div id="admin">
<h2>Painel do Fundador</h2>

<select id="admEstado"></select>
<label>Cor da UF</label>
<input type="color" id="admCor" value="#0b5ed7">
<button onclick="definirCor()">Definir cor do estado</button>

<hr>

<select id="admCargo">
  <option>presidente</option>
  <option>governador</option>
  <option>senador</option>
  <option>deputado</option>
</select>
<input id="admNome" placeholder="Nome">
<input id="admPartido" placeholder="Partido">
<button onclick="abrirGaleriaFoto()">Escolher Foto</button>
<input type="hidden" id="admFoto">
<input type="number" id="admVotos" placeholder="Votos">
<button onclick="criarCandidato()">Criar candidato</button>

<hr>
<input type="number" id="admUrnas" placeholder="% Urnas">
<input type="number" id="admBrancos" placeholder="Brancos">
<input type="number" id="admNulos" placeholder="Nulos">

<h3>Controle de % de Urnas por Estado</h3>
<select id="admEstadoSlider" onchange="atualizarSliderEstado()"></select>
<input type="range" id="sliderUrnas" min="0" max="100" value="0" oninput="atualizarSlider(this.value)">
<span id="valorSlider">0%</span>

<hr>
<h3>Status Rápido – Presidente Nacional</h3>
<p>Marque um candidato como ELEITO ou 2º TURNO diretamente no painel geral:</p>
<div id="painelStatusRapido"></div>
<button onclick="atualizarPainelStatus()">Atualizar Lista</button>

<hr>
<h3 style="color:red">Apagar Candidatos</h3>
<label>Selecione o cargo que deseja apagar:</label>
<select id="admCargoApagar">
  <option value="presidente">Presidente</option>
  <option value="governador">Governador</option>
  <option value="senador">Senador</option>
  <option value="deputado">Deputado</option>
</select>
<button id="btnApagar" style="background:#dc3545;color:white;padding:10px;border:none;border-radius:6px;cursor:pointer;">Apagar Todos Candidatos do Cargo</button>

<hr>
<h3 style="color:red">Resetar Tudo</h3>
<button id="btnResetarTudo" style="background:#0d6efd;color:white;padding:10px;border:none;border-radius:6px;cursor:pointer;">RESETAR TODOS OS DADOS</button>

<div id="listaAdmin"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, set, push, update, remove, get, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAE-c6y2Z1JsQplCfj1UNW7Wyr4ssCsJQU",
  authDomain: "tse-painel.firebaseapp.com",
  databaseURL: "https://tse-painel-default-rtdb.firebaseio.com",
  projectId: "tse-painel",
  storageBucket: "tse-painel.firebasestorage.app",
  messagingSenderId: "818733405394",
  appId: "1:818733405394:web:8e3e3e45062e3122e9490b",
  measurementId: "G-49XLVVE7D5"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const senha="2007";
const avatar="https://via.placeholder.com/100?text=Foto";
const estados=["AC","AL","AP","AM","BA","CE","DF","ES","GO","MA","MT","MS","MG","PA","PB","PR","PE","PI","RJ","RN","RS","RO","RR","SC","SP","SE","TO","EXTERIOR"];

const estadosDiv=document.getElementById("estados");
const sel=document.getElementById("admEstado");
const selSlider=document.getElementById("admEstadoSlider");
const slider=document.getElementById("sliderUrnas");
const valorSlider=document.getElementById("valorSlider");

// Inicializa dropdowns e estados
estados.forEach(e=>{
  estadosDiv.innerHTML+=`<div class="estado" id="uf-${e}" onclick="abrir('${e}')">${e}<small>0%</small></div>`;
  sel.innerHTML+=`<option>${e}</option>`;
  selSlider.innerHTML+=`<option>${e}</option>`;
  const estadoRef = ref(db,'estados/'+e);
  get(estadoRef).then(snap=>{ if(!snap.exists()) set(estadoRef,{ urnas:0, brancos:0, nulos:0, cor:"#e0e0e0", candidatos:{} }); });
});

// Login do fundador
window.login = function(){ 
  if(prompt("Senha do fundador")==senha){ 
    document.getElementById("admin").style.display="block"; 
    atualizarListaAdmin(); 
    atualizarPainelStatus();
    atualizarSliderEstado();

    // Botão Apagar Candidatos
    const btnApagar = document.getElementById("btnApagar");
    btnApagar.addEventListener("click", async ()=>{
      const cargo = document.getElementById("admCargoApagar").value;
      if(!confirm(`Deseja apagar TODOS os candidatos do cargo "${cargo}"?`)) return;
      for(const uf of estados){
        const snap = await get(ref(db, `estados/${uf}/candidatos`));
        if(snap.exists()){
          const candidatos = snap.val();
          for(const key in candidatos){
            if(candidatos[key].cargo === cargo){
              await remove(ref(db, `estados/${uf}/candidatos/${key}`));
            }
          }
        }
      }
      alert(`Todos os candidatos do cargo "${cargo}" foram apagados com sucesso!`);
      atualizarListaAdmin();
      atualizarPainelStatus();
    });

    // Botão Resetar Tudo
    const btnResetarTudo = document.getElementById("btnResetarTudo");
    btnResetarTudo.addEventListener("click", async ()=>{
      if(!confirm("Tem certeza que deseja RESETAR TODOS OS DADOS? Isso não pode ser desfeito.")) return;
      for(const uf of estados){
        await set(ref(db,'estados/'+uf), { urnas:0, brancos:0, nulos:0, cor:"#e0e0e0", candidatos:{} });
      }
      alert("Todos os dados foram resetados!");
      atualizarListaAdmin();
      atualizarPainelStatus();
    });
  } 
}
</script>

</body>
</html>
